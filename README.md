## 株式会社フィックスポイント　プログラミング試験

## 概要
使用言語：Python 3.11.0 

exam01～04が同番号の設問の解答に対応したプログラムになります。  
log.txtがテストに使用したログファイルになります。  
各プログラムは監視ログファイルと同じディレクトリに置くものとして作成しています。  
各設問での主な追加・変更点をテスト結果の後ろに記述しています。

## 設問1
### テスト実行結果

```
$ python exam01.py

         :address         :failure found         confirm recovery
failure  :10.20.30.1/16   :2020-10-19 13:31:24   2020-10-19 13:32:24
failure  :10.20.30.1/16   :2020-10-19 13:33:24   2020-10-19 13:35:24
failure  :10.20.30.2/16   :2020-10-19 13:33:25   2020-10-19 13:36:25
failure  :192.168.1.1/24  :2020-10-19 13:35:34   2020-10-19 13:36:34
failure  :192.168.1.2/24  :2020-10-19 13:35:35   2020-10-19 13:36:35
failure  :10.20.30.1/16   :2020-10-19 13:36:24   2020-10-19 13:37:24
failure  :192.168.1.4/24  :2020-11-19 13:31:24   2020-11-19 13:31:25
failure  :192.168.1.6/32  :2020-10-19 13:37:35   No data
```

読みだしたログを保持するためのデータ構造としてPing_logクラスを作成しました。  
日付データの管理は利便性を考慮しdatetimeオブジェクトで行いました。

故障期間の出力は故障からの復旧が確認できるログを読みだした際に行います。
出力内容としてサーバーアドレス、故障が確認された日時、故障からの復旧が確認された日時の3つをターミナルから出力します。

ログ上で故障からの復旧が確認できなかった記録については復旧確認日時を”No data"とし、最後に出力します

## 設問2
### テスト実行結果

```
$ python exam02.py

Nの値を入力してください
2
         :address         :failure found         confirm recovery
failure  :10.20.30.1/16   :2020-10-19 13:33:24   2020-10-19 13:35:24
failure  :10.20.30.2/16   :2020-10-19 13:33:25   2020-10-19 13:36:25
```
### 変更点

故障しているサーバーの記録を保持している failure_server_dict を拡張し、タイムアウトの連続回数を記録できるようにしました。
タイムアウトの回数がNの値を超えたサーバーを故障と判定し、ログに出力します。


## 設問3
### テスト実行結果

```
$ python exam03.py

N回以上連続してタイムアウトした場合にのみ故障とみなします
Nの値を入力してください
2
直近m回の平均応答時間がtミリ秒を超えた場合は、サーバが過負荷状態になっているとみなします。
mの値を入力してください
2
tの値を入力してください
100

:status    :address         :failure found         :confirm recovery   

:failure   :10.20.30.1/16   :2020-10-19 13:33:24   :2020-10-19 13:35:24
:failure   :10.20.30.2/16   :2020-10-19 13:33:25   :2020-10-19 13:36:25
:overload  :10.20.30.2/16   :2020-10-19 13:33:25   :2020-10-19 13:37:25
:overload  :192.168.1.1/24  :2020-10-19 13:35:34   :2020-10-19 13:37:34
:overload  :192.168.1.2/24  :2020-10-19 13:35:35   :2020-10-19 13:37:35
:overload  :192.168.1.4/24  :2020-11-19 13:31:24   :2020-11-19 13:31:34
:overload  :10.20.30.1/16   :2020-10-19 13:31:24   :No data
:overload  :192.168.1.6/32  :2020-10-19 13:37:35   :No data
:overload  :192.168.1.4/24  :2020-11-19 13:32:24   :No data
```
### 変更点

直近m回以内にタイムアウトが発生している場合、平均値に関わらず過負荷であると判定します

ログの分析内容が故障と過負荷の二通りになったことを踏まえ、それぞれの解析フローを関数化しました。（check_failure,check_overload）

各サーバーアドレスごとに値を保持するためにServerクラスを追加しました。  
各サーバーアドレスをkey、Serverクラスをvalueとしたdictで管理します。  
これに伴い、設問2で似た役割を担っていたfailure_server_dictを改修し、Serverクラスに機能を移行しました。

各サーバーの直近M回の応答結果をキューで保持し、新しいログの読み込みの際はキューの更新を行います。

データの出力箇所がログの解析処理内に散逸していたため、解析処理後にまとめて出力する形に変更しました。  
過負荷を検知した日時～過負荷の解消を検知した日時までを出力します。  
ログ上で異常の解消が確認できなかった記録については復旧確認日時を”No data"とし、最後に出力します。  

## 設問4
### テスト実行結果

```
$ python exam04.py

N回以上連続してタイムアウトした場合にのみ故障とみなします
Nの値を入力してください
2

直近m回の平均応答時間がtミリ秒を超えた場合は、サーバが過負荷状態になっているとみなします
mの値を入力してください
2

tの値を入力してください
100

N:2, m:2, t:100

:status         :address          :failure found         :confirm recovery

:failure        :10.20.30.1/16    :2020-10-19 13:33:24   :2020-10-19 13:35:24
:subnet_error   :10.20.0.0/16     :2020-10-19 13:34:25   :2020-10-19 13:35:24
:failure        :10.20.30.2/16    :2020-10-19 13:33:25   :2020-10-19 13:36:25
:overload       :10.20.30.2/16    :2020-10-19 13:33:25   :2020-10-19 13:37:25
:overload       :192.168.1.1/24   :2020-10-19 13:35:34   :2020-10-19 13:37:34
:overload       :192.168.1.2/24   :2020-10-19 13:35:35   :2020-10-19 13:37:35
:overload       :192.168.1.4/24   :2020-11-19 13:31:24   :2020-11-19 13:31:34
:overload       :10.20.30.1/16    :2020-10-19 13:31:24   :No data
:overload       :192.168.1.6/32   :2020-10-19 13:37:35   :No data
:overload       :192.168.1.4/24   :2020-11-19 13:32:24   :No data
```
### 変更点

扱いやすさを考慮し、IPアドレスの型を文字列型からipaddressモジュールのIPv4Addressオブジェクトに変更しました。

各サブネット単位で記録を保持するためのクラスとしてSubnetクラスを作成しました。
オブジェクトの管理はServerクラスと同様にdictを用いて行います。（network_dict）

サブネットの故障を判定するフローとして新たにcheck_subnet_failureメソッドを作成しました。  
ログから読みだした情報をもとにSubnetオブジェクトを操作し、サブネット全体のタイムアウトを検知・記録します。  
サブネットの故障はstatus: subnet_errorとして出力します。